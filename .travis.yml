language: c
compiler: gcc

git:
  depth: 100
  submodules: true

branches:
  only:
    - master
    
jobs:
  include:
    - stage: build
      name: "Build i386 Linux"
      cache: ccache
      os: linux
      dist: bionic
      addons:
        apt:
          packages:
            - libgoogle-perftools-dev:i386
            - libfreetype6-dev:i386
            - libsdl2-dev:i386
            - gcc-multilib
            - g++-multilib
      before_script:
        - git submodule update --remote --merge
        - cd src/
        - sha1sum ./devtools/bin/vpc
        - ./devtools/bin/vpc /h
        - ./creategameprojects
      script:
        - make -f games.mak NO_CHROOT=1 2> /dev/null
      after_success:
        - echo "Done" # TODO: Archive build artifacts and create a distributable zi
